'=======================================================================================
'Unifloc 7.26  coronav2                                          khabibullin.ra@gubkin.ru
'Petroleum engineering calculations modules (macroses)
'2000 - 2020
'
'=======================================================================================
'
'  Clogger - класс описывающий объект логирования и контроля качества расчетов
'  Logger живет паралельно с расчетныим классами и умеет принимать от них сообщения о нештатных ситуациях при проведении расчетов
'           он копит информацию и теоретически может ее анализировать и строить статистику
'
Option Explicit
Public msg_collection As New Collection    ' список всех сообщений об ошибках
Public Sub ClearAll()
 Set msg_collection = Nothing
 Set msg_collection = New Collection
End Sub
' функция для передачи сообщения о предупреждении или ошибки для обработки
' параметры
'      - описание ошибки
'      - уровень ошибки  - критическая ошибка, предупреждение, коррекция данных
'      - контекст в котором вызвана ошибка - название функции, тип расчета который ведется (как собрать? можно сделать общий параметр у класса отвественный за контекст проведения расчета)
Public Function AddMsg(msg As String) As Long
  
    On Error Resume Next
  '  Dim lm As CLogMsg
    
  '  Set lm = New CLogMsg    ' создали новый объект
    
  '  lm.name = msg
    msg_collection.Add msg          ' добавляем сообщение в список
    AddMsg = msg_collection.Count
End Function
'Public Function SaveToFile()
'    Dim FullFileName As String
'    Dim dir As String
'
'    FullFileName = ThisWorkbook.Path & "\" & "oppump.log"
'
'    Open FullFileName For Output As #1
'    Dim st As CLogMsg
'
'On Error Resume Next
'    ' on english version office - russian letter can cause file write error here
'    For Each st In msg_collection
'        Print #1, st.TypeErr & " " & st.name:
'    Next
'    Close #1
''    ts.Close: Set ts = Nothing: Set FSO = Nothing
'End Function
Public Function get_str() As String
    get_str = ConvertToJson(msg_collection)
End Function

