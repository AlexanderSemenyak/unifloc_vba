'=======================================================================================
'Unifloc 7.27a primavera                                          khabibullinra@gmail.com
'Petroleum engineering calculations modules (macroses)
'2000 - 2021
'
'=======================================================================================
'
Option Explicit
'  класс для описания параметров сепарации газа на приеме ЭЦН, включая сепарацию роторным газосепаратором
'
' описание газосепаратора
Public isGasSep As Boolean   ' флаг того, что ГС работает
'Public ksep_total_manual_fr As Double     '
Public ksep_gassep_fr As Double           ' коэффициент сепарации газосепаратора, расчетный
Public ksep_nat_fr As Double              ' коэффициент естественной сепарации, расчетный
Public ksep_liquid_d As Double
Public ksep_water_d As Double
Public p_ksep_atma As Double              ' давление сепарации, расчетное
Public t_ksep_C As Double                 ' температура сепарации расчетная
Public separation_mode As String ' флаг для ручного задания параметров сепарации
                                           ' 0 - нет - расчет автоматический
                                           ' 1 - Ксеп ручной, давления автомат
                                           ' 2 - Ксеп ручной, давления и температура ручные
' выбор моделей расчета сепарации
Public gassep_type As Long
Public natsep_type As Long
' вручную заданные параметры для соответствующего режима расчета
'Public ksep_total_man_d As Double
Public psep_man_atma As Double
Public tsep_man_C As Double
Public ksep_gassep_man_d As Double
Public ksep_nat_man_d As Double
Public ksep_liquid_man_d As Double
Public ksep_water_man_d As Double
Public manufacturer As String
Public name As String
Public length_m As Double
' геометрические параметры насоса
Private length_m_ As Double                ' длина должна быть не нулевая, для того чтобы корректно строились графики по скважине
Private h_mes_top_ As Double               ' глубина установки газосепаратора по верхней части
Private d_od_mm_ As Double                 ' внешний диаметр
Public angle_deg As Double                 ' угол установки УЭЦН (предполагается, что по глубине угол не меняется)
Public d_cas_m As Double                   ' диаметр эксплуатационной колонны в месте установки сепаратора
' общие параметры
Private fluid_ As CPVT                     ' флюид исходный
Private fluid_gs_ As CPVT                     ' флюид исходный
Private fluid_tub_ As CPVT                 ' флюид после сепарации
Private fluid_cas_ As CPVT                 ' флюид после сепарации - то что идет в затруб
'Private is_ksep_manual_ As Boolean         ' флаг для ручного учета газосепаратора
'  параметры для задания упрощенной модели сепаратора
Private ksep_gassep_max_d_  As Double
Private ksep_q_max_m3day_    As Double                    ' максимальный дебит для газосепаратора для упрощенной характеристики
'Private q_mix_gassep_rc_m3day_ As Double
Private m_Nm_ As Double                    ' момент потребляемый
Public freq_Hz As Double
 
 
Public Property Get ksep_total_fr() As Double
' общая сепарация УЭЦН параметр только для чтения
' для задания вручную надо задать естественную сепарацию и сепарацию газосепаратора
    ksep_total_fr = ksep_nat_fr + (1 - ksep_nat_fr) * ksep_gassep_fr
End Property
 
' свойство для выдачи момента
Public Property Get M_Nm() As Double
    If isGasSep Then
        M_Nm = m_Nm_
    Else
        M_Nm = 0
    End If
End Property
Private Sub Class_Initialize()
    Call set_gassep_param(OD_mm:=125, _
                          Qnom_m3day:=250, _
                          h_mes_top_m:=0, _
                          d_cas_mm:=0, _
                          length_m:=3, _
                          angle_deg:=90)
'    is_ksep_manual_ = False
    
    
    'dPower_GasSep_W = 500
    isGasSep = True
    separation_mode = byCorrealation
    ksep_nat_fr = 0.5
    ksep_gassep_fr = 0.5
    
    'ksep_total_manual_fr = -1
    m_Nm_ = 1
    ksep_gassep_max_d_ = 0.9
    ksep_q_max_m3day_ = 500
End Sub
 Public Sub set_ksep_total(calc_method As SEPAR_CALC_METHOD, _
                                  ksep_nat_fr As Double, _
                         Optional ksep_GS_fr As Double = 0, _
                         Optional p_ksep_atma As Double = -1, _
                         Optional t_ksep_C As Double = -1)
 ' устанавливает значение сепарации для уэцн вручную
 ' сначала установим значение газосепаратора - оно всегда одинаково для всех вариантов
    
    If ksep_GS_fr > 0 And ksep_GS_fr <= 1 Then
        isGasSep = True
    Else
       isGasSep = False
    End If
    
    ksep_gassep_man_d = ksep_GS_fr
    psep_man_atma = p_ksep_atma
    tsep_man_C = t_ksep_C
    ksep_nat_man_d = ksep_nat_fr
    
    ' установим метод расчета
    ' но так чтобы он не противоречил введенным данным
     If ksep_nat_fr >= 0 And ksep_nat_fr <= 1 And p_ksep_atma > 0 And t_ksep_C > 0 Then
        ' если ввели хорошие параметры то можно применить любой метод расчета
         separation_mode = calc_method
     ElseIf ksep_nat_fr >= 0 And ksep_nat_fr <= 1 And p_ksep_atma <= 0 Then
        ' плохое значение давления не позволяет полностью ручной метод
        If calc_method <> fullyManual Then
            separation_mode = calc_method
        Else
            separation_mode = valueManual
        End If
     ElseIf (ksep_nat_fr < 0 Or ksep_nat_fr > 1) And (p_ksep_atma > 0 And t_ksep_C > 0) Then
        ' плохая сепарация, но хорошие давления
         If calc_method = byCorrealation Or calc_method = pressureManual Then
            separation_mode = calc_method
         Else
            separation_mode = pressureManual
        End If
     Else
         ' плохая сепарация не позволяет ручной расчет
         separation_mode = byCorrealation
     End If
     
 End Sub
Public Function calc_separation(p_atma As Double, t_C As Double, f_Hz As Double)
' расчет сепарации и соответствующих параметров флюидов
' должен вызываться незавимо от расчета УЭЦН, так как при расчете сверху вниз
'   необходимо заранее рассчитать параметры флюида выше насоса, чтобы правильно посчитать НКТ
' p_atma  - давление при которой идет сепарация
' T_C - температура при которой идет сепарация
    freq_Hz = f_Hz
    Select Case separation_mode
        Case "byCorrealation"
            ' все по сепарации по корреляциям
            p_ksep_atma = p_atma
            t_ksep_C = t_C
            Call fluid_.calc_PVT(p_ksep_atma, t_ksep_C)
            With fluid_
                ' оценим естественную сепарацию
                ksep_nat_fr = estimate_nat_separation_d(p_ksep_atma, t_ksep_C)
                ' сгенерируем флюид для затруба
                Set fluid_gs_ = fluid_.clone()
                Call fluid_gs_.mod_after_separation(p_ksep_atma, t_ksep_C, ksep_total_fr, True)
                ' оценим коэффициент сепарации газосепаратора
                ksep_gassep_fr = estimate_GS_separation_d(p_ksep_atma, t_ksep_C, f_Hz)
                
            End With
        Case "pressureManual"
            ' берем значение ручное, давления как есть
            p_ksep_atma = psep_man_atma
            t_ksep_C = tsep_man_C
             Call fluid_.calc_PVT(p_ksep_atma, t_ksep_C)
            With fluid_
                ' оценим естественную сепарацию
                ksep_nat_fr = estimate_nat_separation_d(p_ksep_atma, t_ksep_C)
                ' сгенерируем флюид для затруба
                Set fluid_gs_ = fluid_.clone()
                Call fluid_gs_.mod_after_separation(p_ksep_atma, t_ksep_C, ksep_total_fr, True)
                ' оценим коэффициент сепарации газосепаратора
                ksep_gassep_fr = estimate_GS_separation_d(p_ksep_atma, t_ksep_C, f_Hz)
                
            End With
        Case "valueManual"
            ' берем и коэффициенты и давления как было задано при установке значений
            p_ksep_atma = p_atma
            t_ksep_C = t_C
            ksep_nat_fr = ksep_nat_man_d
            ksep_gassep_fr = ksep_gassep_man_d
            Call fluid_.calc_PVT(p_ksep_atma, t_ksep_C)
        Case "fullyManual"
            ' берем и коэффициенты и давления как было задано при установке значений
            p_ksep_atma = psep_man_atma
            t_ksep_C = tsep_man_C
            ksep_nat_fr = ksep_nat_man_d
            ksep_gassep_fr = ksep_gassep_man_d
            ksep_liquid_d = ksep_liquid_man_d
            ksep_water_d = ksep_water_man_d
            Call fluid_.calc_PVT(p_ksep_atma, t_ksep_C)
        
    End Select
    
    ' потом, когда будет расчет газосепаратора - то надо будет разделить алгоритмы
    ' ручного задания и задания с использованием газосепаратора
    If isGasSep Then
        ksep_gassep_fr = ksep_gassep_fr
    Else
        ksep_gassep_fr = 0
    End If
    
    Set fluid_tub_ = fluid_.clone()
    Call fluid_tub_.mod_after_separation(p_ksep_atma, t_ksep_C, ksep_total_fr, True)
    Set fluid_cas_ = fluid_.clone() ' тут надо будет доделать чтобы считать затруб с газом
    fluid_cas_.q_gas_free_sm3day = fluid.q_gas_insitu_sm3day * ksep_total_fr
    
    calc_separation = ksep_total_fr
    
End Function
Public Sub set_gassep_param(Optional OD_mm As Double = 125, _
                       Optional Qnom_m3day As Double = 250, _
                       Optional h_mes_top_m As Double = 0, _
                       Optional angle_deg As Double = 90, _
                       Optional d_cas_mm As Double = 0, _
                       Optional length_m As Double = 1)
' метод инициализации параметров газосепаратора
' в зависимости от габарита
' OD_mm     - определяет габарит
' h_mes_top_m - глубина подвеса в скважине, может пригодится когда то, пока про запас
' Angle_deg - угол установки к горизонтали 90 - вертикально
' d_cas_mm   - диаметр эксплуатационной колоны в месте установки
    d_od_mm_ = OD_mm
    Me.angle_deg = angle_deg
    If d_cas_mm = 0 Then
        Me.d_cas_m = (OD_mm + 10) / 1000
    Else
        Me.d_cas_m = d_cas_mm / 1000
    End If
    h_mes_top_ = h_mes_top_m
    length_m_ = length_m
    ksep_q_max_m3day_ = Qnom_m3day * 2
    
End Sub
Public Sub init_json(json As String)
    Dim d As Dictionary
    
    Set d = ParseJson(json)
    
    Call init_dictionary(d)
 End Sub
 
 Private Sub init_dictionary(dict As Dictionary)
 
 Dim ESP_ID As Long
 Dim head_nom_m As Double
 Dim msg As String
On Error GoTo err1:
    With dict
        If .Exists("separation_mode") Then separation_mode = .Item("separation_mode")
        If .Exists("gassep_type") Then gassep_type = .Item("gassep_type")
        If .Exists("natsep_type") Then natsep_type = .Item("natsep_type")
        If .Exists("psep_man_atma") Then psep_man_atma = .Item("psep_man_atma")
        If .Exists("tsep_man_C") Then tsep_man_C = .Item("tsep_man_C")
        If .Exists("ksep_gassep_man_d") Then ksep_gassep_man_d = .Item("ksep_gassep_man_d")
        If .Exists("ksep_nat_man_d") Then ksep_nat_man_d = .Item("ksep_nat_man_d")
        If .Exists("ksep_liquid_man_d") Then ksep_liquid_man_d = .Item("ksep_liquid_man_d")
        If .Exists("M_Nm") Then m_Nm_ = .Item("M_Nm")
        
        If .Exists("manufacturer") Then manufacturer = .Item("manufacturer")
        If .Exists("name") Then name = .Item("name")
        If .Exists("length_m") Then length_m = .Item("length_m")
    End With
    
    Exit Sub
err1:
    Dim errmsg As String
    errmsg = "Error:CESPGasSep.init_dictionary: init error " & sDELIM & Err.Description
    add_log_msg errmsg
    Err.Raise kErrESPcalc, Err.source, errmsg
 End Sub
' =======================  геометрия
'Public Property Get length_m() As Double
'    length_m = length_m_
'End Property
' глубина установки  (верхняя точка)
Public Property Get h_mes_top_m() As Double
   h_mes_top_m = h_mes_top_
End Property
'Public Property Let h_mes_top_m(val As Double)
'   h_mes_top_ = val
'End Property
' глубина нижней точки установки
Public Property Get h_mes_down_m() As Double
   h_mes_down_m = h_mes_top_m + length_m
End Property
Public Property Get d_od_m() As Double
   d_od_m = d_od_mm_ / 1000
End Property
' угол к горизонтали под которым установлена установка
' угол задается извне системой скважиной при установке системы в скважину
Public Property Get angle_vert_deg() As Double
   angle_vert_deg = angle_vert_deg - 90
End Property
Public Property Get fluid() As CPVT
   Set fluid = fluid_
End Property
Public Property Get fluid_tub() As CPVT
   Set fluid_tub = fluid_tub_
End Property
Public Property Get fluid_cas() As CPVT
   Set fluid_cas = fluid_cas_
End Property
Public Property Set fluid(val As CPVT)
  Set fluid_ = val       ' берем новый объект в работу
  Set fluid_tub_ = val
  Set fluid_cas_ = val
End Property
'Public Property Get is_ksep_manual() As Boolean
'   is_ksep_manual = is_ksep_manual_
'End Property
'
'Public Property Let is_ksep_manual(val As Boolean)
'   is_ksep_manual_ = val
'End Property
Private Sub Separatefluids()
' метод для принудительного разделения свойст флюида
   ' создаем новые экзампляры
   Set fluid_tub_ = New CPVT
   Set fluid_cas_ = New CPVT
   '  копируем в них значения
   fluid_tub_.copy fluid_
   fluid_cas_.copy fluid_
End Sub
Private Function estimate_GS_separation_d(p_atma As Double, t_C As Double, f_Hz As Double)
' расчет коэффициента сепарации газосепаратора
' предполагается линейная зависимость от дебита
' q_mix_rc_m3day - расход ГЖС поступающей на вход с учетом естественной сепарации с рабочих условиях
' потом хорошо бы уточнить и приспособить для разных видов конструкции
    Dim KS As Double
    Dim q_mix_ As Double
    Dim qmax As Double
    
    Call fluid_gs_.calc_PVT(p_atma, t_C)
    Select Case gassep_type
        Case -1
            
            estimate_GS_separation_d = ksep_gassep_man_d
            
        Case 0
            q_mix_ = fluid_gs_.q_mix_rc_m3day
            qmax = ksep_q_max_m3day_
            
            If q_mix_ < qmax Then
                KS = (1 - q_mix_ / qmax) * ksep_gassep_max_d_
            Else
                KS = 0
            End If
            estimate_GS_separation_d = KS
        Case Else
            estimate_GS_separation_d = my_sepfactor(gassep_type, fluid_gs_.gas_fraction_d * 100, fluid_gs_.q_liq_sm3day, f_Hz * 60) / 100
   End Select
    
End Function
Private Function estimate_nat_separation_d(p_atma As Double, t_C As Double) As Double
    Call fluid.calc_PVT(p_atma, t_C)
    With fluid
        Select Case natsep_type
            Case 0
                estimate_nat_separation_d = unf_natural_separation(d_od_m, d_cas_m, _
                                                        .q_liq_sm3day, .q_gas_insitu_sm3day, .bo_m3m3, .bg_m3m3, .sigma_oil_gas_Nm, .sigma_wat_gas_Nm, .rho_oil_sckgm3, .rho_gas_sckgm3, .fw_perc)
            Case Else
                 estimate_nat_separation_d = unf_natural_separation(d_od_m, d_cas_m, _
                                                        .q_liq_sm3day, .q_gas_insitu_sm3day, .bo_m3m3, .bg_m3m3, .sigma_oil_gas_Nm, .sigma_wat_gas_Nm, .rho_oil_sckgm3, .rho_gas_sckgm3, .fw_perc)
         End Select
    End With
End Function
'
'' метод построения кривой зависимости коэффициента сепарации от дебита
'Public Function Build_SeparCurve()
'
''    Dim i As Integer
''    Dim qtest As Double, Rptest As Double
''    Dim qinit As Double, Rpinit As Double, Rsbinit As Double
''    Dim qmin As Double, Qmax As Double
''    Dim Ks As Double
''    Dim numPoint As Integer
''
''    curve(str_ksep_natQl_curve).ClearPoints
''    curve(str_ksep_gassepQl_curve).ClearPoints
''    curve(str_ksep_totalQl_curve).ClearPoints
''
''    curve(str_ksep_natRp_curve).ClearPoints
''    curve(str_ksep_gassepRp_curve).ClearPoints
''    curve(str_ksep_totalRp_curve).ClearPoints
''
''    numPoint = 20
''
''    qmin = 0: Qmax = 500
''
''    'одолжим ненадолго дебит по скважине
''    qinit = q_liq_sm3day
''    Rpinit = fluid.rp_m3m3
''    Rsbinit = fluid.rsb_m3m3
''
''    For i = 0 To numPoint
''        qtest = (Qmax - qmin) / numPoint * i + qmin
''        q_liq_sm3day = qtest
''        Ks = calc_SeparationAtIntake_d(p_int_atma_, t_int_C_)
''
''        curve(str_ksep_natQl_curve).AddPoint qtest, ksep_natural_d_
''        curve(str_ksep_gassepQl_curve).AddPoint qtest, ksep_gassep_d_
''        curve(str_ksep_totalQl_curve).AddPoint qtest, ksep_total_d_
''    Next i
''
''    ' вернем дебит по скважине назад
''    q_liq_sm3day = qinit
''
''    ' далее построим кривые по сепарации изменяя газовый фактор на скважине
''    Rptest = max(fluid.rsb_m3m3 - 100, 50)
''
''    For i = 0 To numPoint
''        Rptest = Rptest + 10
''        fluid.rp_m3m3 = Rptest
''
''        Ks = calc_SeparationAtIntake_d(p_int_atma_, t_int_C_)
''
''        curve(str_ksep_natRp_curve).AddPoint qtest, ksep_natural_d_
''        curve(str_ksep_gassepRp_curve).AddPoint qtest, ksep_gassep_d_
''        curve(str_ksep_totalRp_curve).AddPoint qtest, ksep_total_d_
''    Next i
''    fluid.rp_m3m3 = Rpinit
''    fluid.rsb_m3m3 = Rsbinit
'
'End Function
'
''
''  МОДУЛЬ РАСЧЕТА КОЭФФИЦИЕНТА СЕПАРАЦИИ
''
'**************************************************************************************************************************
'' ДОСТУПНЫЕ ФУНКЦИИ
' MY_SEPFACTOR  - Вычисление коэффициента сепрации в точке
' MY_INAREA     - Определяет принадлежность точки к измеренной области
' MY_GMIN       - Минимальные замеренные газосодержания для каждого из сепараторов
' MY_GMAX       - Максимальные замеренные газосодержания для каждого из сепараторов
' MY_QMIN       - Минимальные замеренные дебиты для каждого из сепараторов
' MY_QMAX       - Максимальные замеренные дебиты для каждого из сепараторов
' MY_FMIN       - Минимальные замеренные частоты для каждого из сепараторов
' MY_FMAX       - Максимальные замеренные частоты для каждого из сепараторов
'**************************************************************************************************************************
'' ОБЪЯВЛЕНИЯ ДОСТУПНЫХ ФУНКЦИЙ
' Public Function my_sepfactor(SEP_TYPE As Integer, G As Double, Q As Double, F As Double) As Double
' Public Function my_inarea(SEP_TYPE As Integer, G As Double, Q As Double, F As Double, Optional PARAM = "GQF") As Boolean
' Public Function my_gmin(SEP_TYPE As Integer) As Double
' Public Function my_gmax(SEP_TYPE As Integer) As Double
' Public Function my_qmin(SEP_TYPE As Integer) As Double
' Public Function my_qmax(SEP_TYPE As Integer) As Double
' Public Function my_fmin(SEP_TYPE As Integer) As Double
' Public Function my_fmax(SEP_TYPE As Integer) As Double
' Public Function my_theta(SEP_TYPE As Integer, NUM_PAR As Integer) As Double
'**************************************************************************************************************************
'' ПРИМЕЧАНИЕ К АРГУМЕНТАМ ДОСТУПНЫХ ФУНКЦИЙ
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
'   G       - входное газосодержание
'
'   Q       - дебит
'
'   F       - частота
'
'   PARAM   - параметры области проверки (default = "GQF")
'
'    "GQF"  - проверка по ГАЗУ, дебитУ, ЧАСТОТЕ
'    "GQ"  - проверка по ГАЗУ, дебитУ
'    "GF"  - проверка по ГАЗУ, ЧАСТОТЕ
'    "QF"  - проверка по дебитУ, ЧАСТОТЕ
'    "G"  - проверка по ГАЗУ
'    "Q"  - проверка по дебитУ
'    "F"  - проверка по ЧАСТОТЕ
'
'**************************************************************************************************************************
Public Function my_sepfactor(ByVal SEP_TYPE As Integer, G As Double, q As Double, F As Double) As Double
'
' MY_SEPFACTOR - Вычисление коэффициента сепрации в точке
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
'   G       - входное газосодержание
'
'   Q       - дебит
'
'   F       - частота
'
' Переменные для сшивок
Dim MX  As Double
Dim Func, dfunc As Double
Dim kA, kB, kC As Double
Dim mX2, R As Double
Dim mD As Double
' Множитель (подобранная константа) для сшивки по дебиту в области максимума
Dim MULT As Double
MULT = 1.3
'
' ВАЖНО!!!
' Далее: Проверка области идет только по ГАЗОСОДЕРЖАНИЮ и дебитУ
'        Проверки области по ЧАСТОТЕ вообще нет
'
' Если точка лежит в замеренной области, используем аппроксимацию
If (my_inarea(SEP_TYPE, G, q, F, "GQ")) Then
    my_sepfactor = my_sepfactor_approx(SEP_TYPE, G, q, F)
    
End If
' Если точка лежит вне замеренной области, используем сшивки
' (1) Сшивка с параболическим цилиндром только по дебиту в области нуля
If (q < my_qmin(SEP_TYPE)) And (my_inarea(SEP_TYPE, G, q, F, "G")) Then
    MX = my_qmin(SEP_TYPE)
            
    Func = my_sepfactor_approx(SEP_TYPE, G, MX, F)
    dfunc = my_sepfactor_approx(SEP_TYPE, G, MX, F, "dQ")
            
    kA = dfunc / MX
    kB = -dfunc
    kC = Func
            
    my_sepfactor = kA * q ^ 2 + kB * q + kC
End If
' (2) Сшивка с параболическим цилиндром только по дебиту в области максимума
If (q > my_qmax(SEP_TYPE)) And (my_inarea(SEP_TYPE, G, q, F, "G")) Then
    MX = my_qmax(SEP_TYPE)
            
    ' mQ2
    mX2 = MULT * MX
          
    If (q > mX2) Then
        my_sepfactor = 0
            
    Else
        Func = my_sepfactor_approx(SEP_TYPE, G, MX, F)
        dfunc = my_sepfactor_approx(SEP_TYPE, G, MX, F, "dQ")
                
        R = MX - mX2
        kA = (dfunc * R - Func) / R / R
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        my_sepfactor = kA * q ^ 2 + kB * q + kC
    
    End If
End If
' (3) Сшивка с параболическим цилиндром только по газу в области нуля
If (G < my_gmin(SEP_TYPE)) And (my_inarea(SEP_TYPE, G, q, F, "Q")) Then
    MX = my_gmin(SEP_TYPE)
            
    Func = my_sepfactor_approx(SEP_TYPE, MX, q, F)
    dfunc = my_sepfactor_approx(SEP_TYPE, MX, q, F, "dG")
            
    kA = (MX * dfunc - Func) / MX / MX
    kB = dfunc - 2 * MX * kA
            
    my_sepfactor = kA * G ^ 2 + kB * G
    
End If
   
' (4) Сшивка с параболическим цилиндром только по газу в области максимума
If (G > my_gmax(SEP_TYPE)) And (my_inarea(SEP_TYPE, G, q, F, "Q")) Then
    MX = my_gmax(SEP_TYPE)
            
    ' mG2
    mX2 = 100
            
    If (G > mX2) Then
        my_sepfactor = 0
            
    Else
        Func = my_sepfactor_approx(SEP_TYPE, MX, q, F)
        dfunc = my_sepfactor_approx(SEP_TYPE, MX, q, F, "dG")
                
        R = MX - mX2
        kA = (dfunc * R - Func) / R / R
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        my_sepfactor = kA * G ^ 2 + kB * G + kC
    
    End If
End If
' (5) Сшивка с параболоидом вращения по газу в области нуля и по дебиту в области нуля
If (G < my_gmin(SEP_TYPE)) And (q < my_qmin(SEP_TYPE)) Then
    MX = my_qmin(SEP_TYPE)
    mD = my_gmin(SEP_TYPE)
            
    Func = my_sepfactor_approx(SEP_TYPE, mD, MX, F)
    dfunc = my_sepfactor_approx(SEP_TYPE, mD, MX, F, "dQ")
            
    kA = dfunc / MX
    kB = -dfunc
    kC = Func
            
    Func = kA * q ^ 2 + kB * q + kC
    MX = my_gmin(SEP_TYPE)
    mD = my_qmin(SEP_TYPE)
    
    dfunc = my_sepfactor_approx(SEP_TYPE, MX, mD, F, "dG")
            
    kA = (MX * dfunc - Func) / MX / MX
    kB = dfunc - 2 * MX * kA
            
    my_sepfactor = kA * G ^ 2 + kB * G
    
End If
' (6) Сшивка с параболоидом вращения по газу в области нуля и по дебиту в области максимума
If (G < my_gmin(SEP_TYPE)) And (q > my_qmax(SEP_TYPE)) Then
    MX = my_qmax(SEP_TYPE)
            
    ' mQ2
    mX2 = MULT * MX
          
    If (q > mX2) Then
        my_sepfactor = 0
            
    Else
        mD = my_gmin(SEP_TYPE)
        
        Func = my_sepfactor_approx(SEP_TYPE, mD, MX, F)
        dfunc = my_sepfactor_approx(SEP_TYPE, mD, MX, F, "dQ")
                
        R = MX - mX2
        kA = (dfunc * R - Func) / R / R
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        Func = kA * q ^ 2 + kB * q + kC
    
        MX = my_gmin(SEP_TYPE)
        mD = my_qmax(SEP_TYPE)
    
        dfunc = my_sepfactor_approx(SEP_TYPE, MX, mD, F, "dG")
            
        kA = (MX * dfunc - Func) / MX / MX
        kB = dfunc - 2 * MX * kA
            
        my_sepfactor = kA * G ^ 2 + kB * G
    
    End If
End If
' (7) Сшивка с параболоидом вращения по газу в области максимума и по дебиту в области нуля
If (G > my_gmax(SEP_TYPE)) And (q < my_qmin(SEP_TYPE)) Then
    MX = my_qmin(SEP_TYPE)
    mD = my_gmax(SEP_TYPE)
            
    Func = my_sepfactor_approx(SEP_TYPE, mD, MX, F)
    dfunc = my_sepfactor_approx(SEP_TYPE, mD, MX, F, "dQ")
            
    kA = dfunc / MX
    kB = -dfunc
    kC = Func
            
    Func = kA * q ^ 2 + kB * q + kC
    
    MX = my_gmax(SEP_TYPE)
    mD = my_qmin(SEP_TYPE)
            
    ' mG2
    mX2 = 100
            
    If (G > mX2) Then
        my_sepfactor = 0
            
    Else
        dfunc = my_sepfactor_approx(SEP_TYPE, MX, mD, F, "dG")
                
        R = MX - mX2
        kA = (dfunc * R - Func) / R / R
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        my_sepfactor = kA * G ^ 2 + kB * G + kC
    
    End If
End If
' (8) Сшивка с параболоидом вращения по газу в области максимума и по дебиту в области максимума
If (G > my_gmax(SEP_TYPE)) And (q > my_qmax(SEP_TYPE)) Then
    MX = my_qmax(SEP_TYPE)
            
    ' mQ2
    mX2 = MULT * MX
          
    If (q > mX2) Then
        my_sepfactor = 0
            
    Else
        mD = my_gmax(SEP_TYPE)
        
        Func = my_sepfactor_approx(SEP_TYPE, mD, MX, F)
        dfunc = my_sepfactor_approx(SEP_TYPE, mD, MX, F, "dQ")
                
        R = MX - mX2
        kA = (dfunc * R - Func) / R / R
        kB = dfunc - 2 * kA * MX
        kC = -kA * mX2 ^ 2 - kB * mX2
                   
        Func = kA * q ^ 2 + kB * q + kC
    
        MX = my_gmax(SEP_TYPE)
        mD = my_qmax(SEP_TYPE)
            
        ' mG2
        mX2 = 100
            
        If (G > mX2) Then
            my_sepfactor = 0
            
        Else
            dfunc = my_sepfactor_approx(SEP_TYPE, MX, mD, F, "dG")
                
            R = MX - mX2
            kA = (dfunc * R - Func) / R / R
            kB = dfunc - 2 * kA * MX
            kC = -kA * mX2 ^ 2 - kB * mX2
                   
            my_sepfactor = kA * G ^ 2 + kB * G + kC
    
        End If
    
    End If
End If
' Обрезка по значению
If (my_sepfactor < 0) Then
    my_sepfactor = 0
    
End If
If (my_sepfactor > 100) Then
    my_sepfactor = 100
    
End If
End Function
'**************************************************************************************************************************
Public Function my_inarea(SEP_TYPE As Integer, G As Double, q As Double, F As Double, Optional param = "GQF") As Boolean
'
' MY_INAREA - Определяет принадлежность точки к измеренной области
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
'   G       - входное газосодержание
'
'   Q       - дебит
'
'   F       - частота
'
'   PARAM   - параметры области проверки (default = "GQF")
'
'    "GQF"  - проверка по ГАЗУ, дебитУ, ЧАСТОТЕ
'    "GQ"  - проверка по ГАЗУ, дебитУ
'    "GF"  - проверка по ГАЗУ, ЧАСТОТЕ
'    "QF"  - проверка по дебитУ, ЧАСТОТЕ
'    "G"  - проверка по ГАЗУ
'    "Q"  - проверка по дебитУ
'    "F"  - проверка по ЧАСТОТЕ
'
my_inarea = True
If (param = "GQF") Or (param = "G") Or (param = "GQ") Or (param = "GF") Then
    If (G < my_gmin(SEP_TYPE)) Or (G > my_gmax(SEP_TYPE)) Then
        my_inarea = False
    End If
End If
If (param = "GQF") Or (param = "Q") Or (param = "GQ") Or (param = "QF") Then
    If (q < my_qmin(SEP_TYPE)) Or (q > my_qmax(SEP_TYPE)) Then
        my_inarea = False
    End If
End If
If (param = "GQF") Or (param = "F") Or (param = "GF") Or (param = "QF") Then
    If (F < my_fmin(SEP_TYPE)) Or (F > my_fmax(SEP_TYPE)) Then
        my_inarea = False
    End If
End If
End Function
'**************************************************************************************************************************
Public Function my_gmin(SEP_TYPE As Integer) As Double
'
' MY_GMIN - Минимальные замеренные газосодержания для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim gmin(1 To 29) As Double
gmin(1) = 6
gmin(2) = 5
gmin(3) = 9
gmin(4) = 8
gmin(5) = 6
gmin(6) = 7
gmin(7) = 10
gmin(8) = 11
gmin(9) = 5
gmin(10) = 6
gmin(11) = 11
gmin(12) = 9
gmin(13) = 11
gmin(14) = 10
gmin(15) = 11
gmin(16) = 11
gmin(17) = 10
gmin(18) = 11
gmin(19) = 5
gmin(20) = 13
gmin(21) = 2
gmin(22) = 2
gmin(23) = 2
gmin(24) = 2
gmin(25) = 2
gmin(26) = 2
gmin(27) = 2
gmin(28) = 2
gmin(29) = 2
my_gmin = gmin(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_gmax(SEP_TYPE As Integer) As Double
'
' MY_GMAX - Максимальные замеренные газосодержания для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim gmax(1 To 29) As Double
gmax(1) = 81
gmax(2) = 75
gmax(3) = 72
gmax(4) = 64
gmax(5) = 66
gmax(6) = 73
gmax(7) = 73
gmax(8) = 73
gmax(9) = 61
gmax(10) = 73
gmax(11) = 69
gmax(12) = 69
gmax(13) = 58
gmax(14) = 62
gmax(15) = 67
gmax(16) = 74
gmax(17) = 73
gmax(18) = 66
gmax(19) = 62
gmax(20) = 74
gmax(21) = 75
gmax(22) = 80
gmax(23) = 80
gmax(24) = 80
gmax(25) = 80
gmax(26) = 90
gmax(27) = 93
gmax(28) = 97
gmax(29) = 99.5
my_gmax = gmax(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_qmin(SEP_TYPE As Integer) As Double
'
' MY_QMIN - Минимальные замеренные дебиты для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim qmin(1 To 29) As Double
qmin(1) = 50
qmin(2) = 50
qmin(3) = 80
qmin(4) = 50
qmin(5) = 50
qmin(6) = 50
qmin(7) = 80
qmin(8) = 65
qmin(9) = 50
qmin(10) = 50
qmin(11) = 70
qmin(12) = 50
qmin(13) = 80
qmin(14) = 80
qmin(15) = 80
qmin(16) = 50
qmin(17) = 50
qmin(18) = 50
qmin(19) = 50
qmin(20) = 80
qmin(21) = 10
qmin(22) = 10
qmin(23) = 10
qmin(24) = 10
qmin(25) = 10
qmin(26) = 10
qmin(27) = 10
qmin(28) = 10
qmin(29) = 10
my_qmin = qmin(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_qmax(SEP_TYPE As Integer) As Double
'
' MY_QMAX - Максимальные замеренные дебиты для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim qmax(1 To 29) As Double
qmax(1) = 200
qmax(2) = 300
qmax(3) = 350
qmax(4) = 200
qmax(5) = 80
qmax(6) = 200
qmax(7) = 350
qmax(8) = 350
qmax(9) = 200
qmax(10) = 200
qmax(11) = 350
qmax(12) = 200
qmax(13) = 350
qmax(14) = 350
qmax(15) = 350
qmax(16) = 200
qmax(17) = 200
qmax(18) = 200
qmax(19) = 200
qmax(20) = 350
qmax(21) = 250
qmax(22) = 360
qmax(23) = 405
qmax(24) = 650
qmax(25) = 830
qmax(26) = 1300
qmax(27) = 360
qmax(28) = 680
qmax(29) = 2100
my_qmax = qmax(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_fmin(SEP_TYPE As Integer) As Double
'
' MY_FMIN - Минимальные замеренные частоты для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim fmin(1 To 29) As Double
fmin(1) = 2037
fmin(2) = 2037
fmin(3) = 2037
fmin(4) = 2037
fmin(5) = 2037
fmin(6) = 2037
fmin(7) = 2037
fmin(8) = 2037
fmin(9) = 2037
fmin(10) = 2037
fmin(11) = 2037
fmin(12) = 2037
fmin(13) = 2037
fmin(14) = 2037
fmin(15) = 2037
fmin(16) = 2037
fmin(17) = 2037
fmin(18) = 2037
fmin(19) = 2037
fmin(20) = 2037
fmin(21) = 2037
fmin(22) = 2037
fmin(23) = 2037
fmin(24) = 2037
fmin(25) = 2037
fmin(26) = 2037
fmin(27) = 2037
fmin(28) = 2037
fmin(29) = 2037
my_fmin = fmin(SEP_TYPE)
End Function
'**************************************************************************************************************************
Public Function my_fmax(SEP_TYPE As Integer) As Double
'
' MY_FMAX - Максимальные замеренные частоты для каждого из сепараторов
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
Dim fmax(1 To 29) As Double
fmax(1) = 4074
fmax(2) = 4074
fmax(3) = 4074
fmax(4) = 4074
fmax(5) = 4074
fmax(6) = 4074
fmax(7) = 4074
fmax(8) = 4074
fmax(9) = 4074
fmax(10) = 4074
fmax(11) = 4074
fmax(12) = 4074
fmax(13) = 4074
fmax(14) = 4074
fmax(15) = 4074
fmax(16) = 4074
fmax(17) = 4074
fmax(18) = 4074
fmax(19) = 4074
fmax(20) = 4074
fmax(21) = 4074
fmax(22) = 4074
fmax(23) = 4074
fmax(24) = 4074
fmax(25) = 4074
fmax(26) = 4074
fmax(27) = 4074
fmax(28) = 4074
fmax(29) = 4074
my_fmax = fmax(SEP_TYPE)
End Function
'**************************************************************************************************************************
Private Function my_sepfactor_approx(SEP_TYPE As Integer, G As Double, q As Double, F As Double, Optional Diff = "0") As Double
'
' MY_SEPFACTOR_APPROX - Вычисление коэффициента сепарации по аппроксимированной зависимости
'
'   SEP_TYPE    - тип сепаратора (номер от 1 до 29)
'
'    1  - 'GDNK5'
'    2  - 'VGSA (VORTEX)'
'    3  - 'GDNK5A'
'    4  - 'GSA5-1'
'    5  - 'GSA5-3'
'    6  - 'GSA5-4'
'    7  - 'GSAN-5A'
'    8  - 'GSD-5A'
'    9  - 'GSD5'
'    10 - '3MNGB5'
'    11 - '3MNGB5A'
'    12 - '3MNGDB5'
'    13 - '3MNGDB5A'
'    14 - 'MNGSL5A-M'
'    15 - 'MNGSL5A-TM'
'    16 - 'MNGSL5-M'
'    17 - 'MNGSL5-TM'
'    18 - 'MNGSLM 5'
'    19 - 'MNGD 5'
'    20 - 'GSIK 5A'
'    21 - '338DSR'
'    22 - '400GSR'
'    23 - '400GSV'
'    24 - '400GSVHV'
'    25 - '538 GSR'
'    26 - '538 GSVHV'
'    27 - '400FSR(OLD)'
'    28 - '513GRS(OLD)'
'    29 - '675HRS'
'   G       - входное газосодержание
'
'   Q       - дебит
'
'   F       - частота
'
'   DIFF    - параметр отвечающий за тип возвращаемой функции (default = "0")
'
'    "0"    - сама функция
'    "dG"   - частная производная функции по ГАЗОСОДЕРЖАНИЮ
'    "dQ"   - частная производная функции по дебитУ
'    "dF"   - частная производная функции по ЧАСТОТЕ
'
'
' Коэффициенты theta для каждого из сепараторов
'
Dim Theta(29, 12) As Double
' Separator 1
Theta(1, 1) = 0.0000087993
Theta(1, 2) = -0.0014178073
Theta(1, 3) = -0.0000397231
Theta(1, 4) = 0.0529674339
Theta(1, 5) = 0.0028493727
Theta(1, 6) = -0.0001228876
Theta(1, 7) = -0.0003862197
Theta(1, 8) = 0.0000106863
Theta(1, 9) = 0.5323060089
Theta(1, 10) = -0.1045923688
Theta(1, 11) = 0.0042861775
Theta(1, 12) = 53.8027001706
' Separator 2
Theta(2, 1) = -0.0000033628
Theta(2, 2) = -0.000113117
Theta(2, 3) = -0.0000184548
Theta(2, 4) = 0.0379809715
Theta(2, 5) = 0.0002438456
Theta(2, 6) = -0.000187424
Theta(2, 7) = 0.0000051195
Theta(2, 8) = -0.0000281111
Theta(2, 9) = 0.3766056508
Theta(2, 10) = 0.0181773837
Theta(2, 11) = 0.0142218617
Theta(2, 12) = -15.4481969434
' Seperator 3
Theta(3, 1) = 0.0000193145
Theta(3, 2) = -0.0032176704
Theta(3, 3) = -0.0000268557
Theta(3, 4) = 0.1586937256
Theta(3, 5) = 0.001828688
Theta(3, 6) = 0.0000708432
Theta(3, 7) = 0.0000909372
Theta(3, 8) = 0.000002863
Theta(3, 9) = -2.2448483948
Theta(3, 10) = -0.1327032137
Theta(3, 11) = -0.0030459177
Theta(3, 12) = 83.023509036
' Separator 4
Theta(4, 1) = -0.0000121897
Theta(4, 2) = 0.0025164879
Theta(4, 3) = -0.0000028248
Theta(4, 4) = -0.1863706573
Theta(4, 5) = -0.0007591736
Theta(4, 6) = 0.0002146303
Theta(4, 7) = 0.0001319112
Theta(4, 8) = 0.0000187202
Theta(4, 9) = 4.7766561554
Theta(4, 10) = -0.248984867
Theta(4, 11) = -0.0078065695
Theta(4, 12) = 26.2222417751
' Separator 5
Theta(5, 1) = 0.000010823
Theta(5, 2) = -0.0009684032
Theta(5, 3) = 0.0000130572
Theta(5, 4) = -0.0108147984
Theta(5, 5) = -0.0014076182
Theta(5, 6) = -0.00016922
Theta(5, 7) = 0.0007632356
Theta(5, 8) = 0.0000450615
Theta(5, 9) = 2.4191921328
Theta(5, 10) = -0.5524742079
Theta(5, 11) = 0.0039670382
Theta(5, 12) = 36.3660078595
' Separator 6
Theta(6, 1) = 0.0000058748
Theta(6, 2) = -0.0010769325
Theta(6, 3) = -0.0001222593
Theta(6, 4) = 0.0440466354
Theta(6, 5) = 0.0059103956
Theta(6, 6) = -0.0000181232
Theta(6, 7) = -0.0001555878
Theta(6, 8) = -0.0000124109
Theta(6, 9) = 0.7733866636
Theta(6, 10) = -0.118996349
Theta(6, 11) = 0.0028025138
Theta(6, 12) = 37.2251716889
'Separator 7
Theta(7, 1) = 0.000012022
Theta(7, 2) = -0.0017563374
Theta(7, 3) = -0.000064176
Theta(7, 4) = 0.0516750115
Theta(7, 5) = 0.0036795894
Theta(7, 6) = -0.0001779426
Theta(7, 7) = 0.0001613525
Theta(7, 8) = 0.0000084679
Theta(7, 9) = 1.6141781555
Theta(7, 10) = -0.2709599353
Theta(7, 11) = 0.0053775602
Theta(7, 12) = 49.926744881
'Separator 8
Theta(8, 1) = 0.0000116489
Theta(8, 2) = -0.0017284962
Theta(8, 3) = -0.0000885852
Theta(8, 4) = 0.0748456716
Theta(8, 5) = 0.003782259
Theta(8, 6) = 0.0000198235
Theta(8, 7) = 0.00019585
Theta(8, 8) = 0.0000094082
Theta(8, 9) = -0.1554049804
Theta(8, 10) = -0.2084908311
Theta(8, 11) = 0.0000103522
Theta(8, 12) = 55.7924480363
' Separator 9
Theta(9, 1) = -0.0000175932
Theta(9, 2) = 0.0019442256
Theta(9, 3) = 0.000046518
Theta(9, 4) = -0.0915221068
Theta(9, 5) = -0.0045489642
Theta(9, 6) = 0.0001682606
Theta(9, 7) = 0.000113029
Theta(9, 8) = 0.0000093349
Theta(9, 9) = 2.3354157928
Theta(9, 10) = -0.138238023
Theta(9, 11) = -0.0032357402
Theta(9, 12) = 25.9629556167
' Separator 10
Theta(10, 1) = 0.000002168
Theta(10, 2) = -0.000580099
Theta(10, 3) = -0.000029187
Theta(10, 4) = 0.0295065279
Theta(10, 5) = 0.0021737201
Theta(10, 6) = -0.0001052936
Theta(10, 7) = 0.0005934199
Theta(10, 8) = -0.0000239206
Theta(10, 9) = 0.7706293953
Theta(10, 10) = -0.2349725504
Theta(10, 11) = 0.0077944851
Theta(10, 12) = 22.0384189232
' Separator 11
Theta(11, 1) = 0.0000116564
Theta(11, 2) = -0.0020258339
Theta(11, 3) = -0.0000132657
Theta(11, 4) = 0.0995299309
Theta(11, 5) = -0.0007598466
Theta(11, 6) = -0.0000548158
Theta(11, 7) = -0.0000563956
Theta(11, 8) = -0.000010392
Theta(11, 9) = -0.2427459027
Theta(11, 10) = 0.0202310281
Theta(11, 11) = 0.0075101346
Theta(11, 12) = 4.27422002
' Separator 12
Theta(12, 1) = 0.0000056722
Theta(12, 2) = -0.0009737803
Theta(12, 3) = 0.0000005938
Theta(12, 4) = 0.0385538944
Theta(12, 5) = -0.0007528789
Theta(12, 6) = 0.0000842402
Theta(12, 7) = 0.000261956
Theta(12, 8) = -0.0000111876
Theta(12, 9) = 0.6643632145
Theta(12, 10) = -0.1234937687
Theta(12, 11) = -0.0035724804
Theta(12, 12) = 40.793213002
' Separator 13
Theta(13, 1) = 0.0000417791
Theta(13, 2) = -0.0056881068
Theta(13, 3) = 0.0000136645
Theta(13, 4) = 0.2398766601
Theta(13, 5) = -0.0015630531
Theta(13, 6) = -0.0000285158
Theta(13, 7) = -0.0000045129
Theta(13, 8) = -0.0000097042
Theta(13, 9) = -2.1483675056
Theta(13, 10) = 0.0024168463
Theta(13, 11) = 0.002841826
Theta(13, 12) = 15.9686497148
' Separator 14
Theta(14, 1) = 0.0000124079
Theta(14, 2) = -0.0018989305
Theta(14, 3) = -0.0000685307
Theta(14, 4) = 0.0923074028
Theta(14, 5) = 0.0028970542
Theta(14, 6) = 0.0000901038
Theta(14, 7) = -0.0000619527
Theta(14, 8) = 0.000007167
Theta(14, 9) = -1.0808076124
Theta(14, 10) = -0.0810091369
Theta(14, 11) = -0.0071249283
Theta(14, 12) = 67.7249657484
' Separator 15
Theta(15, 1) = 0.0000019904
Theta(15, 2) = -0.0005274256
Theta(15, 3) = -0.0000001321
Theta(15, 4) = 0.0134467294
Theta(15, 5) = -0.0001740387
Theta(15, 6) = 0.0001078648
Theta(15, 7) = 0.000037294
Theta(15, 8) = -0.0000022572
Theta(15, 9) = 1.1347218547
Theta(15, 10) = -0.0796020472
Theta(15, 11) = -0.0092552662
Theta(15, 12) = 58.1899663666
' Separator 16
Theta(16, 1) = -0.0000025266
Theta(16, 2) = 0.00047723
Theta(16, 3) = -0.0000944762
Theta(16, 4) = -0.0398647861
Theta(16, 5) = 0.0041625028
Theta(16, 6) = -0.000070289
Theta(16, 7) = 0.0009218642
Theta(16, 8) = 0.0000009868
Theta(16, 9) = 2.3891544407
Theta(16, 10) = -0.4062646547
Theta(16, 11) = -0.001223861
Theta(16, 12) = 46.3205673503
' Separator 17
Theta(17, 1) = 0.0000070011
Theta(17, 2) = -0.0011447747
Theta(17, 3) = -0.0000773086
Theta(17, 4) = 0.0451625345
Theta(17, 5) = 0.0050233714
Theta(17, 6) = 0.0001828168
Theta(17, 7) = 0.0001230263
Theta(17, 8) = 0.000026509
Theta(17, 9) = 0.2681015918
Theta(17, 10) = -0.2887132557
Theta(17, 11) = -0.0155483915
Theta(17, 12) = 82.5608915421
' Separator 18
Theta(18, 1) = 0.0000131145
Theta(18, 2) = -0.0020218787
Theta(18, 3) = -0.0000752502
Theta(18, 4) = 0.0889028466
Theta(18, 5) = 0.002430388
Theta(18, 6) = 0.0000726508
Theta(18, 7) = 0.0006097805
Theta(18, 8) = 0.0000283123
Theta(18, 9) = -0.9279795475
Theta(18, 10) = -0.4347461705
Theta(18, 11) = -0.0039938935
Theta(18, 12) = 93.9145436659
' Separator 19
Theta(19, 1) = 0.0000085993
Theta(19, 2) = -0.0012006374
Theta(19, 3) = 0.0000199194
Theta(19, 4) = 0.0153486403
Theta(19, 5) = -0.0011703937
Theta(19, 6) = 0.0001431831
Theta(19, 7) = -0.0001461161
Theta(19, 8) = 0.000014851
Theta(19, 9) = 1.6030972398
Theta(19, 10) = -0.1368893957
Theta(19, 11) = -0.0037610015
Theta(19, 12) = 37.8893186113
' Separator 20
Theta(20, 1) = 0.0000052149
Theta(20, 2) = -0.0008542311
Theta(20, 3) = 0.0000188589
Theta(20, 4) = 0.0270391744
Theta(20, 5) = -0.0018547051
Theta(20, 6) = -0.0000847238
Theta(20, 7) = -0.0001708993
Theta(20, 8) = 0.0000330029
Theta(20, 9) = 1.0747595188
Theta(20, 10) = -0.2605626409
Theta(20, 11) = -0.004685222
Theta(20, 12) = 78.1426121405
' Separator 21
Theta(21, 1) = -0.0000057686
Theta(21, 2) = 0.0017841804
Theta(21, 3) = 0.0001483174
Theta(21, 4) = -0.2064464015
Theta(21, 5) = -0.0219079147
Theta(21, 6) = -0.0000000207
Theta(21, 7) = -0.0000164214
Theta(21, 8) = -0.0000000065
Theta(21, 9) = 8.8977452453
Theta(21, 10) = 0.2993764227
Theta(21, 11) = 0.0000023453
Theta(21, 12) = 26.5902172049
' Separator 22
Theta(22, 1) = -0.0000148823
Theta(22, 2) = 0.0031307273
Theta(22, 3) = 0.0001281999
Theta(22, 4) = -0.2532762045
Theta(22, 5) = -0.0165203227
Theta(22, 6) = 0.0000000001
Theta(22, 7) = 0.0000364149
Theta(22, 8) = 0.0000000001
Theta(22, 9) = 8.6246826085
Theta(22, 10) = 0.2111779388
Theta(22, 11) = -0.000000021
Theta(22, 12) = 29.5491379611
' Separator 23
Theta(23, 1) = -0.0000104298
Theta(23, 2) = 0.002208906
Theta(23, 3) = 0.00011223
Theta(23, 4) = -0.1895447082
Theta(23, 5) = -0.0146300899
Theta(23, 6) = -0.0000000012
Theta(23, 7) = 0.0001615412
Theta(23, 8) = -0.0000000002
Theta(23, 9) = 7.0218835769
Theta(23, 10) = 0.1291558283
Theta(23, 11) = 0.0000001235
Theta(23, 12) = 43.5724349818
' Separator 24
Theta(24, 1) = -0.0000112867
Theta(24, 2) = 0.0028143661
Theta(24, 3) = 0.0000373215
Theta(24, 4) = -0.2574502614
Theta(24, 5) = -0.0058632671
Theta(24, 6) = 0.0000000005
Theta(24, 7) = -0.0000035432
Theta(24, 8) = 0.0000000002
Theta(24, 9) = 9.0898405078
Theta(24, 10) = 0.0944206556
Theta(24, 11) = -0.0000001149
Theta(24, 12) = 28.8052225675
' Separator 25
Theta(25, 1) = -0.0000047317
Theta(25, 2) = 0.0014358247
Theta(25, 3) = 0.0000360452
Theta(25, 4) = -0.1647687447
Theta(25, 5) = -0.0052902961
Theta(25, 6) = 0.0000000002
Theta(25, 7) = -0.000023142
Theta(25, 8) = 0
Theta(25, 9) = 6.9898540248
Theta(25, 10) = 0.0937383503
Theta(25, 11) = -0.0000000372
Theta(25, 12) = 38.5321169147
' Separator 26
Theta(26, 1) = -0.0000066665
Theta(26, 2) = 0.0016477688
Theta(26, 3) = 0.0000234341
Theta(26, 4) = -0.1609884272
Theta(26, 5) = -0.0034313902
Theta(26, 6) = -0.0000000017
Theta(26, 7) = 0.0000039671
Theta(26, 8) = -0.0000000001
Theta(26, 9) = 6.2720389162
Theta(26, 10) = 0.043843296
Theta(26, 11) = 0.0000001602
Theta(26, 12) = 48.4084469733
' Separator 27
Theta(27, 1) = -0.0000133811
Theta(27, 2) = 0.003036567
Theta(27, 3) = 0.000086037
Theta(27, 4) = -0.2611712442
Theta(27, 5) = -0.0125172084
Theta(27, 6) = -0.0000000021
Theta(27, 7) = 0.0000545221
Theta(27, 8) = -0.0000000003
Theta(27, 9) = 9.0760388084
Theta(27, 10) = 0.1543012733
Theta(27, 11) = 0.0000002117
Theta(27, 12) = 32.0977307469
' Separator 28
Theta(28, 1) = -0.0000125759
Theta(28, 2) = 0.0028445982
Theta(28, 3) = 0.0000370209
Theta(28, 4) = -0.2395693671
Theta(28, 5) = -0.0056313278
Theta(28, 6) = 0.0000000003
Theta(28, 7) = 0.0000484194
Theta(28, 8) = 0
Theta(28, 9) = 8.0537813544
Theta(28, 10) = 0.0446873619
Theta(28, 11) = -0.0000000348
Theta(28, 12) = 45.0662007633
' Separator 29
Theta(29, 1) = -0.0000019919
Theta(29, 2) = 0.0006438949
Theta(29, 3) = 0.0000134658
Theta(29, 4) = -0.0903471166
Theta(29, 5) = -0.0020142629
Theta(29, 6) = -0.0000000004
Theta(29, 7) = 0.0000019207
Theta(29, 8) = 0
Theta(29, 9) = 4.5220839775
Theta(29, 10) = 0.0248272635
Theta(29, 11) = 0.0000000365
Theta(29, 12) = 58.3191138042
' Вычисление функции по аппроксимации
If (Diff = "0") Then
    my_sepfactor_approx = Theta(SEP_TYPE, 1) * G ^ 4 + Theta(SEP_TYPE, 2) * G ^ 3 + Theta(SEP_TYPE, 3) * G ^ 2 * q + Theta(SEP_TYPE, 4) * G ^ 2 + Theta(SEP_TYPE, 5) * G * q + Theta(SEP_TYPE, 6) * G * F + Theta(SEP_TYPE, 7) * q ^ 2 + Theta(SEP_TYPE, 8) * q * F + Theta(SEP_TYPE, 9) * G + Theta(SEP_TYPE, 10) * q + Theta(SEP_TYPE, 11) * F + Theta(SEP_TYPE, 12)
    
End If
' Вычисление производной функции по ГАЗОСОДЕРЖАНИЮ
If (Diff = "dG") Then
    my_sepfactor_approx = 4 * Theta(SEP_TYPE, 1) * G ^ 3 + 3 * Theta(SEP_TYPE, 2) * G ^ 2 + 2 * Theta(SEP_TYPE, 3) * G * q + 2 * Theta(SEP_TYPE, 4) * G + Theta(SEP_TYPE, 5) * q + Theta(SEP_TYPE, 6) * F + Theta(SEP_TYPE, 9)
    
End If
' Вычисление производной функции по дебитУ
If (Diff = "dQ") Then
    my_sepfactor_approx = Theta(SEP_TYPE, 3) * G ^ 2 + Theta(SEP_TYPE, 5) * G + 2 * Theta(SEP_TYPE, 7) * q + Theta(SEP_TYPE, 8) * F + Theta(SEP_TYPE, 10)
    
End If
' Вычисление производной функции по ЧАСТОТЕ
If (Diff = "dF") Then
    my_sepfactor_approx = Theta(SEP_TYPE, 6) * G + Theta(SEP_TYPE, 8) * q + Theta(SEP_TYPE, 11)
    
End If
End Function
'**************************************************************************************************************************
''[EOF]
Public Function Separator_Name(code As Integer) As String
Select Case code
Case 1
Separator_Name = "GDNK5"
Case 2
Separator_Name = "VGSA (VORTEX)"
Case 3
Separator_Name = "GDNK5A"
Case 4
Separator_Name = "GSA5-1"
Case 5
Separator_Name = "GSA5-3"
Case 6
Separator_Name = "GSA5-4"
Case 7
Separator_Name = "GSAN-5A"
Case 8
Separator_Name = "GSD-5A"
Case 9
Separator_Name = "GSD5"
Case 10
Separator_Name = "3MNGB5"
Case 11
Separator_Name = "3MNGB5A"
Case 12
Separator_Name = "3MNGDB5"
Case 13
Separator_Name = "3MNGDB5A"
Case 14
Separator_Name = "MNGSL5A-M"
Case 15
Separator_Name = "MNGSL5A-TM"
Case 16
Separator_Name = "MNGSL5-M"
Case 17
Separator_Name = "MNGSL5-TM"
Case 18
Separator_Name = "MNGSLM 5"
Case 19
Separator_Name = "MNGD 5"
Case 20
Separator_Name = "GSIK 5A"
Case 21
Separator_Name = "338DSR"
Case 22
Separator_Name = "400GSR"
Case 23
Separator_Name = "400GSV"
Case 24
Separator_Name = "400GSVHV"
Case 25
Separator_Name = "538 GSR"
Case 26
Separator_Name = "538 GSVHV"
Case 27
Separator_Name = "400FSR(OLD)"
Case 28
Separator_Name = "513GRS(OLD)"
Case 29
Separator_Name = "675HRS"
Case Else
Separator_Name = "Н/Д"
End Select
End Function
Public Property Get dPower_GasSep_W() As Variant
    dPower_GasSep_W = M_Nm * freq_Hz * 2 * const_Pi
End Property
Public Property Let dPower_GasSep_W(ByVal vNewValue As Variant)
End Property

